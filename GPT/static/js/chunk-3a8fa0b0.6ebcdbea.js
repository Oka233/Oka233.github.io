(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a8fa0b0"],{1035:function(e,t,n){"use strict";n("427a")},"3a56":function(e,t,n){},"427a":function(e,t,n){},"68b1":function(e,t,n){"use strict";n("c02b")},"6f06":function(e,t,n){},"8dc5":function(e,t,n){"use strict";n("c14b")},9406:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dashboard-container"},[n("ChatContainer",{staticClass:"chat-left",on:{"add-chat":e.addChat}}),n("div",{staticClass:"chat-right"},[n("el-button",{attrs:{type:"primary"},on:{click:e.addChat}},[e._v("Start New Chat")]),n("el-button",{attrs:{type:"primary"},on:{click:e.saveChats}},[e._v("Save Chats")]),n("el-button",{attrs:{type:"primary"},on:{click:e.removeChats}},[e._v("Remove Chats")]),n("ChatSettings"),n("ChatStatus")],1)],1)},a=[],i=n("5530"),o=(n("d81d"),n("e9c4"),n("d3b7"),n("159b"),n("2f62")),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"Connection",name:"first"}},[n("div",{staticClass:"first-tab-container"},[n("el-input",{staticClass:"apikey-input",attrs:{placeholder:"API Key"},on:{change:e.saveKey},model:{value:e.dummyApiKey,callback:function(t){e.dummyApiKey=t},expression:"dummyApiKey"}}),n("el-select",{attrs:{placeholder:"选择模型"},on:{change:e.saveModel},model:{value:e.openaiSettings.model,callback:function(t){e.$set(e.openaiSettings,"model",t)},expression:"openaiSettings.model"}},e._l(e.modelOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("div",{staticClass:"switch-container"},[n("span",[e._v(" Autostart ")]),n("el-switch",{on:{change:e.saveAutoStart},model:{value:e.openaiSettings.autoStart,callback:function(t){e.$set(e.openaiSettings,"autoStart",t)},expression:"openaiSettings.autoStart"}})],1),n("div",{staticClass:"switch-container"},[n("span",[e._v(" Stream answers ")]),n("el-switch",{on:{change:e.saveStream},model:{value:e.openaiSettings.stream,callback:function(t){e.$set(e.openaiSettings,"stream",t)},expression:"openaiSettings.stream"}})],1)],1)]),n("el-tab-pane",{attrs:{label:"Advanced",name:"second"}},[n("el-alert",{attrs:{title:"These options are exclusive to stream mode",closable:!1,type:"warning"}}),n("ModelOption",{attrs:{name:"temperature: "+e.openaiSettings.temperature},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.temperature,callback:function(t){e.$set(e.advancedTabCheckboxes,"temperature",t)},expression:"advancedTabCheckboxes.temperature"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:0,max:2,step:.025,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.temperature",t)}},model:{value:e.openaiSettings.temperature,callback:function(t){e.$set(e.openaiSettings,"temperature",t)},expression:"openaiSettings.temperature"}})],1),n("ModelOption",{attrs:{name:"top_p: "+e.openaiSettings.top_p},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.top_p,callback:function(t){e.$set(e.advancedTabCheckboxes,"top_p",t)},expression:"advancedTabCheckboxes.top_p"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:0,max:1,step:.025,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.top_p",t)}},model:{value:e.openaiSettings.top_p,callback:function(t){e.$set(e.openaiSettings,"top_p",t)},expression:"openaiSettings.top_p"}})],1),n("ModelOption",{attrs:{name:"n: "+e.openaiSettings.n},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.n,callback:function(t){e.$set(e.advancedTabCheckboxes,"n",t)},expression:"advancedTabCheckboxes.n"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:1,max:5,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.n",t)}},model:{value:e.openaiSettings.n,callback:function(t){e.$set(e.openaiSettings,"n",t)},expression:"openaiSettings.n"}})],1),n("ModelOption",{attrs:{name:"presence_penalty: "+e.openaiSettings.presence_penalty},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.presence_penalty,callback:function(t){e.$set(e.advancedTabCheckboxes,"presence_penalty",t)},expression:"advancedTabCheckboxes.presence_penalty"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:-2,max:2,step:.025,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.presence_penalty",t)}},model:{value:e.openaiSettings.presence_penalty,callback:function(t){e.$set(e.openaiSettings,"presence_penalty",t)},expression:"openaiSettings.presence_penalty"}})],1),n("ModelOption",{attrs:{name:"frequency_penalty: "+e.openaiSettings.frequency_penalty},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.frequency_penalty,callback:function(t){e.$set(e.advancedTabCheckboxes,"frequency_penalty",t)},expression:"advancedTabCheckboxes.frequency_penalty"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:-2,max:2,step:.025,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.frequency_penalty",t)}},model:{value:e.openaiSettings.frequency_penalty,callback:function(t){e.$set(e.openaiSettings,"frequency_penalty",t)},expression:"openaiSettings.frequency_penalty"}})],1),n("ModelOption",{attrs:{name:"max_tokens: "+e.openaiSettings.max_tokens},on:{change:e.saveCheckboxes},model:{value:e.advancedTabCheckboxes.max_tokens,callback:function(t){e.$set(e.advancedTabCheckboxes,"max_tokens",t)},expression:"advancedTabCheckboxes.max_tokens"}},[n("el-slider",{staticClass:"slot-slider",attrs:{min:0,max:4096,step:1,"show-input":"","show-input-controls":!1,"show-tooltip":!1},on:{input:function(t){return e.savePath("openaiSettings.max_tokens",t)}},model:{value:e.openaiSettings.max_tokens,callback:function(t){e.$set(e.openaiSettings,"max_tokens",t)},expression:"openaiSettings.max_tokens"}})],1),n("el-button",{on:{click:e.resetAdvancedSettings}},[e._v("Reset")])],1)],1)},r=[];n("99af"),n("caad"),n("2532"),n("4de4"),n("7db0"),n("b64b");function u(e,t){if(e=e.split("."),1===e.length)localStorage.setItem(e[0],JSON.stringify(t));else{for(var n=JSON.parse(localStorage.getItem(e[0]))||{},s=n,a=1;a<e.length;a++){if(a===e.length-1){n[e[a]]=t;break}void 0===n[e[a]]&&(n[e[a]]={}),n=n[e[a]]}localStorage.setItem(e[0],JSON.stringify(s))}}function l(e){e=e.split(".");for(var t=JSON.parse(localStorage.getItem(e[0])),n=1;n<e.length;n++){if(null===t)return null;t=void 0===t[e[n]]?null:t[e[n]]}return t}var h={set:u,get:l},d=n("c7eb"),p=n("2909"),m=n("1da1"),g=n("d4ec"),f=n("bee2"),b=(n("fb6a"),n("3ca3"),n("ddb0"),n("cb29"),n("5c08")),v=n("5c96"),y=n("4360"),S=function(){function e(t){Object(g["a"])(this,e),this.apiKey=this.getSetting("apiKey"),this.apiKey?this.init():Object(v["Message"])({message:"Please set your OpenAI API key first",type:"warning"}),this.sysMessage="If any code block exists in your message, add corresponding language type for it. Start a conversation with your greeting."}return Object(f["a"])(e,[{key:"getSetting",value:function(e){return e in y["a"].getters.advancedTabCheckboxes?y["a"].getters.advancedTabCheckboxes[e]?y["a"].getters.openaiSettings[e]:void 0:y["a"].getters.openaiSettings[e]}},{key:"init",value:function(){var e=new b["Configuration"]({organization:"",apiKey:this.apiKey});delete e.baseOptions.headers["User-Agent"],this.openai=new b["OpenAIApi"](e)}},{key:"listEngines",value:function(){return this.openai.listEngines()}},{key:"chat",value:function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(t){var n;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.toOpenAI(),console.log("request",n),e.abrupt("return",this.openai.createChatCompletion({model:this.getSetting("model"),messages:[{role:"system",content:this.sysMessage}].concat(Object(p["a"])(n)),temperature:0}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"streamChat",value:function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(t,n,s){var a,i,o,c,r,u,l,h,m=this;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=function(e){var t=e.split(',"finish_reason":').length-1,n=[],s=e;while(t-- >1){var a=s.indexOf(',"finish_reason":'),i=s;s=s.slice(a);var o=s.indexOf("{");s=s.slice(o,s.lastIndexOf("}")+1),i=i.slice(0,a+o+1),i=i.slice(0,i.lastIndexOf("}")+1),n.push(i)}return n.push(s.slice(s.indexOf("{"),s.lastIndexOf("}")+1)),n},o={model:this.getSetting("model"),messages:[{role:"system",content:this.sysMessage}].concat(Object(p["a"])(t)),stream:!0},c=["temperature","top_p","n","presence_penalty","frequency_penalty","max_tokens"],c.forEach((function(e){var t=m.getSetting(e);void 0!==t&&(o[e]=t)})),console.log("request",o),e.next=7,fetch("https://api.openai.com/v1/chat/completions",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.apiKey},method:"POST",body:JSON.stringify(o)});case 7:r=e.sent,u=null===(a=r.body)||void 0===a?void 0:a.pipeThrough(new TextDecoderStream).getReader(),l=Object(d["a"])().mark((function e(){var t,a,c,l,h,p,m;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.read();case 2:if(t=e.sent,null===t||void 0===t||!t.done){e.next=5;break}return e.abrupt("return","break");case 5:if(null!==t&&void 0!==t&&t.value){e.next=7;break}return e.abrupt("return","continue");case 7:if(a=t.value.slice(t.value.indexOf("{"),t.value.lastIndexOf("}")+1),200===(null===r||void 0===r?void 0:r.status)){e.next=12;break}return c=JSON.parse(a),Object(v["Message"])({message:c.error.message,type:"error"}),e.abrupt("return","break");case 12:l=i(a).map((function(e){return JSON.parse(e)})),h=new Array(o.n||1).fill(""),p=new Array(o.n||1),m={prompt_tokens:0,completion_tokens:0,total_tokens:0},l.forEach((function(e){var t,n,s=null===(t=e.choices[0])||void 0===t?void 0:t.index;void 0!==s&&(h[s]+=(null===(n=e.choices[0].delta)||void 0===n?void 0:n.content)||"",p[s]=e.choices[0].finish_reason)})),n(h),s(m,p);case 19:case"end":return e.stop()}}),e)}));case 10:return e.delegateYield(l(),"t0",12);case 12:if(h=e.t0,"break"!==h){e.next=15;break}return e.abrupt("break",19);case 15:if("continue"!==h){e.next=17;break}return e.abrupt("continue",10);case 17:e.next=10;break;case 19:case"end":return e.stop()}}),e,this)})));function t(t,n,s){return e.apply(this,arguments)}return t}()}],[{key:"getDefaultSettings",value:function(){return function(){return{name:"openaiSettings",detail:{apiKey:"",model:"",autoStart:!0,stream:!0,temperature:1,top_p:1,n:1,stop:null,presence_penalty:0,frequency_penalty:0,logit_bias:null,max_tokens:2048}}}()}}]),e}(),_=n("53ca");function k(e){console.log(e.response),e.response?Object(v["Message"])({message:e.response.data.error.message,type:"error"}):(console.log(Object(_["a"])(e)),Object(v["Message"])({message:e.message,type:"error"}))}var C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"model-option-container",class:{"model-option-container-inline":e.inline}},[n("el-checkbox",{on:{change:function(t){return e.$emit("change")}},model:{value:e.localChecked,callback:function(t){e.localChecked=t},expression:"localChecked"}},[e._v(e._s(e.name))]),e._t("default")],2)},O=[],x={name:"ModelOption",model:{prop:"checked",event:"checkChange"},watch:{localChecked:function(e){this.$emit("checkChange",e)},checked:function(e){this.localChecked=e}},props:{checked:{Type:Boolean},name:{type:String,default:""},inline:{type:Boolean,default:!1}},data:function(){return{localChecked:this.checked}}},w=x,I=(n("68b1"),n("2877")),j=Object(I["a"])(w,C,O,!1,null,"08b42a64",null),M=j.exports,A={name:"ChatSettings",components:{ModelOption:M},computed:Object(i["a"])({},Object(o["b"])(["openaiSettings","advancedTabCheckboxes"])),data:function(){return{activeName:"first",dummyApiKey:null,apiKey:null,modelOptions:null}},watch:{apiKey:{handler:function(e,t){e!==t&&this.initModelSelection()}}},created:function(){console.log("____________initializing settings____________"),this.$store.commit("chatSettings/SET_OPENAI_SETTINGS",this.setDefault(S.getDefaultSettings().detail)),this.dummyApiKey=this.openaiSettings.apiKey,this.apiKey=this.openaiSettings.apiKey,Object.assign(this.advancedTabCheckboxes,h.get("advancedTabCheckboxes")),console.log("____________initialization complete____________")},methods:{getSetting:function(e){return e in this.advancedTabCheckboxes?this.advancedTabCheckboxes[e]?this.openaiSettings[e]:void 0:this.openaiSettings[e]},savePath:function(e,t){h.set(e,t)},setDefault:function(e){var t={};for(var n in e){var s=e[n],a="openaiSettings.".concat(n);null===h.get(a)&&h.set(a,s),t[n]=h.get(a),console.log("".concat(n," (").concat(t[n],")"))}return t},initModelSelection:function(){var e=this,t=function(e){return e.id.includes("gpt")};new S({}).listEngines().then((function(n){console.log(n),e.modelOptions=n.data.data.filter(t).map((function(e){return{label:e.id,value:e.id}}));var s=h.get("openaiSettings.model");e.modelOptions.find((function(e){return e.value===s}))?e.openaiSettings.model=s:e.openaiSettings.model="",e.$message({message:"OpenAI API key verified",type:"success"}),e.$store.commit("chat/ENABLE_CHAT"),e.$emit("ready")})).catch((function(t){e.$store.commit("chat/DISABLE_CHAT"),k(t)}))},saveAutoStart:function(){h.set("openaiSettings.autoStart",this.openaiSettings.autoStart)},saveStream:function(){h.set("openaiSettings.stream",this.openaiSettings.stream)},saveKey:function(){this.apiKey=this.dummyApiKey,this.openaiSettings.apiKey=this.dummyApiKey,h.set("openaiSettings.apiKey",this.openaiSettings.apiKey)},saveModel:function(){h.set("openaiSettings.model",this.openaiSettings.model)},saveCheckboxes:function(){var e=this;this.$nextTick((function(t){h.set("advancedTabCheckboxes",e.advancedTabCheckboxes)}))},resetAdvancedSettings:function(){var e=this,t=S.getDefaultSettings().detail;Object.keys(this.advancedTabCheckboxes).forEach((function(n){e.openaiSettings[n]=t[n]}))}}},T=A,$=(n("f271"),Object(I["a"])(T,c,r,!1,null,"e3313ea0",null)),H=$.exports,N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card"},[e.currentChat?n("div",{staticClass:"finish-reason-container"},e._l(e.currentChat.finishStatus,(function(t,s){return n("el-tag",{key:s,attrs:{type:e.mapFinishReason(t)[0]}},[e._v(e._s(e.mapFinishReason(t)[1]))])})),1):e._e()])},E=[],K={name:"ChatStatus",props:{usage:{type:Object},maxTokens:{type:Object}},computed:Object(i["a"])(Object(i["a"])({},Object(o["b"])(["chats","currentRoomId"])),{},{currentChat:function(){var e=this;return this.chats.find((function(t){return t.chatId===e.currentRoomId}))}}),data:function(){return{}},methods:{mapFinishReason:function(e){switch(e){case"stop":return["success","Success"];case"length":return["warning","Length"];case"content_filter":return["warning","Content filter"];case null:return["","Transferring"];default:return["","Transferring"]}}}},D=K,P=(n("8dc5"),Object(I["a"])(D,N,E,!1,null,"0021d80e",null)),R=P.exports,J=n("11c1"),q=n("ade3");n("25f0");function V(){return(new Date).toString().substring(16,21)}function U(){return(new Date).toDateString()}var z={getTimestamp:V,getDate:U},L={me_id:"ME"},B={me_id:"user"},F=function(){function e(t){var n=this;Object(g["a"])(this,e),Object(q["a"])(this,"toVAC",(function(){return this.subMessages?this.subMessages.map((function(e){return{content:e.content,senderId:e.senderId,username:L[e.senderId],date:e.date,timestamp:e.timestamp}})):[{content:this.content,senderId:this.senderId,username:L[this.senderId],date:this.date,timestamp:this.timestamp}]})),Object(q["a"])(this,"toOpenAI",(function(){return this.subMessages?this.subMessages.map((function(e){return{content:e.content,role:B[e.senderId]}})):[{content:this.content,role:B[this.senderId]}]}));var s=function(e){n.content=e.content,n.date=e.date||z.getDate(),n.timestamp=e.timestamp||z.getTimestamp(),n.senderId=e.senderId};if(t.type)switch(t.type){case"text":s(t.message);break;case"sub":this.createSubMessages(t.subMessages)}else s(t)}return Object(f["a"])(e,[{key:"createSubMessages",value:function(t){var n=this;this.subMessages=t.map((function(t){return t.senderId=n.senderId,new e(t)}))}},{key:"getSubMessages",value:function(){return this.subMessages}},{key:"toSave",value:function(){return this.subMessages?{type:"sub",subMessages:this.subMessages.map((function(e){return e.toSave()}))}:{type:"text",message:{content:this.content,senderId:this.senderId,date:this.date,timestamp:this.timestamp}}}}]),e}(),G=function(){function e(t){Object(g["a"])(this,e),Object(q["a"])(this,"toVAC",(function(){var e=[],t=0;return this.messages.forEach((function(n,s){n.toVAC().forEach((function(n){n._id=t++,e.push(n)}))})),e})),Object(q["a"])(this,"toOpenAI",(function(){var e=[];return this.messages.forEach((function(t,n){t.toOpenAI().forEach((function(t){e.push(t)}))})),e})),t=t||{messages:[]},this.messages=t.messages.map((function(e){return new F(e)})),this.usage={prompt_tokens:0,completion_tokens:0,total_tokens:0}}return Object(f["a"])(e,[{key:"streamUsage",value:function(e){this.usage.prompt_tokens+=e.prompt_tokens,this.usage.completion_tokens+=e.completion_tokens,this.usage.total_tokens+=e.total_tokens}},{key:"push",value:function(e){var t=this;e instanceof Array?e.forEach((function(e){return t.push(e)})):this.messages.push(new F(e))}},{key:"streamMessage",value:function(e){var t=this.messages[this.messages.length-1];return e.length>1?t.getSubMessages()?t.getSubMessages().forEach((function(t,n){t.content+=e[n]})):t.createSubMessages(e.map((function(e){return{content:e}}))):t.content+=e[0],e.length}},{key:"recent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.toVAC().slice(-e)}},{key:"toSave",value:function(){return{messages:this.messages.map((function(e){return e.toSave()}))}}}]),e}(),Y=function(){function e(t){Object(g["a"])(this,e),t=t||{},this.chatId=t.chatId||Object(J["v4"])(),this.userName=t.userName||"GPT",L[this.chatId]=this.userName,B[this.chatId]="assistant",this.messageHistory=new G(t.messageHistory),this.AI=new S(t),this.finishStatus=[]}return Object(f["a"])(e,[{key:"getMessageHistory",value:function(){return this.messageHistory.toVAC()}},{key:"nextMessage",value:function(e){var t,n=this,s=this.messageHistory.toVAC();return!e&&s.length?[new Promise((function(e,t){e(n.messageHistory.toVAC())})),null]:(e&&(this.messageHistory.push(e),t=this.messageHistory.recent()),[new Promise((function(e,t){n.AI.chat(n.messageHistory).then((function(t){console.log("result",t);var s=t.data.choices[0].message.content;n.messageHistory.push({content:s,senderId:n.chatId}),e(n.messageHistory.toVAC().slice(-1))})).catch((function(e){t(e)}))})),t])}},{key:"streamNextMessage",value:function(e,t){var n,s=this;e&&(this.messageHistory.push(e),n=this.messageHistory.recent());var a=this.messageHistory.toOpenAI(),i=!1,o=function(e){i||(s.messageHistory.push({content:"",senderId:s.chatId}),i=!0),console.log(e[0]);var a=s.messageHistory.streamMessage(e);t(s.messageHistory.toVAC().slice(-a),n)},c=function(e,t){s.messageHistory.streamUsage(e),s.finishStatus=t};return this.AI.streamChat(a,o,c),n}},{key:"toSave",value:function(){return{chatId:this.chatId,userName:this.userName,messageHistory:this.messageHistory.toSave()}}}]),e}();function Q(e){return new Y(e)}var W={getChat:Q},X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("vue-advanced-chat-md",{class:{disabled:e.chatDisabled},attrs:{height:e.vacHeight+"px","show-audio":"false","show-new-messages-divider":"false","username-options":JSON.stringify({minUsers:1,currentUser:!0}),"show-emojis":"false","show-reaction-emojis":"false","emojis-suggestion-enabled":"false","loading-rooms":e.loadingRooms.toString(),"rooms-loaded":e.roomsLoaded.toString(),"messages-loaded":e.messagesLoaded.toString(),"current-user-id":e.currentUserId,rooms:JSON.stringify(e.rooms),messages:JSON.stringify(e.messages),"room-actions":JSON.stringify(e.roomActions)},on:{"send-message":function(t){return e.sendMessage(t.detail[0])},"fetch-messages":function(t){return e.fetchMessages(t.detail[0])}}})},Z=[],ee=n("3835"),te=n("93a4");Object(te["a"])();var ne={name:"ChatContainer",props:{addChat:{type:Function}},computed:Object(i["a"])(Object(i["a"])({},Object(o["b"])(["chats","chatDisabled","currentRoomId"])),{},{rooms:function(){var e=this.chats.map((function(e,t){return{roomId:"".concat(e.chatId),roomName:"Chat ".concat(t),index:t,users:[{_id:e.chatId,username:e.userName},{_id:"me_id",username:"Me"}]}}));return e.typingUsers=this.typingUsers,e}}),data:function(){return{vacHeight:null,loadingRooms:!1,roomsLoaded:!0,messagesLoaded:!0,currentUserId:"me_id",messages:[],roomActions:[{name:"remove",title:"删除对话"},{name:"export",title:"导出对话"}],typingUsers:[]}},created:function(){},mounted:function(){var e=this;h.get("openaiSettings.autoStart")&&this.$emit("add-chat"),this.resizeHandler(),window.onresize=function(){return function(){e.resizeHandler()}()}},methods:{resizeHandler:function(){this.vacHeight=window.innerHeight-80},getNoneStreamingMessage:function(e,t){var n=this,s=e.getMessageHistory(),a=void 0!==t?{content:t,senderId:"me_id"}:void 0,i=e.nextMessage(a),o=Object(ee["a"])(i,2),c=o[0],r=o[1];a&&(this.messages=[].concat(Object(p["a"])(s),Object(p["a"])(r))),c.then((function(t){e.chatId===n.currentRoomId&&(n.messages=r?[].concat(Object(p["a"])(s),Object(p["a"])(r),Object(p["a"])(t)):[].concat(Object(p["a"])(s),Object(p["a"])(t)))})).catch((function(e){k(e)}))},getStreamingMessage:function(e,t){var n=this,s=e.getMessageHistory(),a=function(t,a,i){e.chatId===n.currentRoomId&&(n.messages=a?[].concat(Object(p["a"])(s),Object(p["a"])(a),Object(p["a"])(t)):[].concat(Object(p["a"])(s),Object(p["a"])(t)))},i=void 0!==t?{content:t,senderId:"me_id"}:void 0,o=e.streamNextMessage(i,a);o&&(this.messages=[].concat(Object(p["a"])(this.messages),Object(p["a"])(o)))},getMessage:function(){h.get("openaiSettings.stream")?this.getStreamingMessage.apply(this,arguments):this.getNoneStreamingMessage.apply(this,arguments)},fetchMessages:function(e){var t=this,n=e.room;e.options;this.$store.commit("chatSettings/SET_ROOM_ID",n.roomId),setTimeout((function(){var e=t.chats.find((function(e){return e.chatId===t.currentRoomId})),n=e.getMessageHistory();0===n.length?t.getMessage(e):t.messages=n}))},sendMessage:function(e){var t=e.roomId,n=e.content,s=(e.files,e.replyMessage,e.usersTag,this.chats.find((function(e){return e.chatId===t})));this.getMessage(s,n)}}},se=ne,ae=(n("1035"),Object(I["a"])(se,X,Z,!1,null,"42405044",null)),ie=ae.exports,oe={name:"Dashboard",components:{ChatContainer:ie,ChatStatus:R,ChatSettings:H},computed:Object(i["a"])({},Object(o["b"])(["chats"])),data:function(){return{}},mounted:function(){this.loadSavedChats()},methods:{saveChats:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.chats.map((function(e){return e.toSave()}));h.set("savedChats",JSON.stringify(t)),e&&this.$message({message:"Chats saved",type:"success"})},removeChats:function(){this.$store.commit("chat/REMOVE_CHATS"),this.saveChats(!1),this.$message({message:"Chats removed",type:"success"})},loadSavedChats:function(){var e=this;this.$store.commit("chat/REMOVE_CHATS");var t=h.get("savedChats");t&&(t=JSON.parse(t),t.forEach((function(t){e.$store.commit("chat/ADD_CHAT",W.getChat(Object(i["a"])({},t)))})))},addChat:function(){h.get("openaiSettings.apiKey")?this.$store.commit("chat/ADD_CHAT",W.getChat({})):h.get("openaiSettings.autoStart")||this.$message({message:"Please set your OpenAI API key first",type:"warning"})}}},ce=oe,re=(n("986a"),Object(I["a"])(ce,s,a,!1,null,"770fd80e",null));t["default"]=re.exports},"986a":function(e,t,n){"use strict";n("6f06")},c02b:function(e,t,n){},c14b:function(e,t,n){},f271:function(e,t,n){"use strict";n("3a56")}}]);